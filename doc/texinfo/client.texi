@c This is part of the Radius manual.
@c Copyright (C) 1999,2000,2001 Sergey Poznyakoff
@c See file radius.texi for copying conditions.
@comment *******************************************************************
@node Client Package, , Utility Programs, Top
@chapter Client Package
@cindex Client Package

Beside the radius server and accompanying utilities, GNU Radius provides
a set of utilities to be used as radius clients.

Following sections describe in detail the parts of the radius client
package.

@menu
* config::        Configuration file is common for all client utilities.
* radsession::    Send arbitrary requests to radius server.
* nas.scm::       A @NAS{} implementation for GNU/Linux machines.
* pam_radius.so:: A PAM module for authentication via radius.
@end menu

@comment *L2****************************************************************
@node config
@section Client Configuration
@cindex Client Configuration
@cindex @file{client.conf}
@cindex @file{raddb/client.conf}

All programs from the client package share the same configuration file:
@file{raddb/client.conf}. The file uses simple line-oriented syntax.
Empty lines are ignored, the @samp{#} introduces an end-of-line comment.

The source @IP{} is introduced with @code{source_ip} statement. Its
syntax is:

@example
source_ip @var{ip-addr}
@end example
@noindent

where @var{ip-addr} must be the @IP{} in ``dotted-quad'' notation.

The radius server where to send the requests to is introduced with
@code{server} statement:

@example
server @var{name} @var{ip-addr} @var{secret} @var{auth-port} @var{acct-port}
@end example
@noindent

Its parts are:

@table @var
@item name
The server name. It is reserved for further use.
@item ip-addr
The server @IP{}.
@item secret
The shared secret to be used when sending requests to this server
@item auth-port
Authentication port number.
@item acct-port
Accounting port number.
@end table

If several @code{server} statement are present, they are tried in
turn until any of them replies to the request.

The amount of time a client program waits for the reply from a
server is configured using @code{timeout} statement:

@example
timepout @var{number}
@end example
@noindent

If the program does not receive any response within @var{number} seconds,
it assumes the server does not respond and either retries the
transmission or tries next available server. Number of retries is
set with @code{retry} statement:

@example
retry @var{number}
@end example

The example of @file{raddb/client.conf} follows:

@exindex @file{client.conf}
@example
@group
server first 10.11.10.1 secret 1645 1646
server second 10.11.10.1 secret 1645 1646
source_ip 127.0.0.1
timeout 3
retry 5
@end group
@end example

@comment *L2****************************************************************
@node radsession
@section radsession
@pindex radsession

@command{radsession} is a Guile script that sends authentication and
accounting requests to the radius server. To invoke the script, run

@example
radsession @var{options} @var{action}
@end example

Possible actions are:

@table @option
@item --auth
Send authentication request.
@item --start
Send accounting start request.
@item --stop
Send accounting stop request.
@end table

Options determine the contents of the request's pairlist. They are:

@table @option
@item -l STRING
@itemx --login STRING
Set login name. 
@item -p STRING
@itemx --passwd STRING
Set password.
@item -n IP
@itemx --nas IP
Set the value of @attr{NAS-IP-Address} attribute.
@item -s STRING
@itemx --sid STRING
Set the session id (@attr{Acct-Session-Id} attribute).
@item -P NUMBER
@itemx --port NUMBER
Set the port number (@attr{NAS-Port-Id} attribute).
@item -h
@itemx --help
Print short usage message and exit.
@item -v
@itemx --verbose
Verbosely list the contents of the received reply.
@end table

@comment *L2****************************************************************
@node nas.scm
@section nas.scm
@pindex nas.scm

@command{nas.scm} is a Guile program that allows to convert a GNU/Linux
box into a @NAS{}. It requires Guile version 1.4 or better and ppp
version 2.3.7 or better.

To use it, you will basically need to do the following:

@enumerate 1
@item Create links:

@example
@group
ln -s @var{libexec}/nas.scm /etc/ppp/ip-up
ln -s @var{libexec}/nas.scm /etc/ppp/ip-down
@end group
@end example
@noindent

Here, @var{libexec} denotes the location of your libexec directory,
where @command{nas.scm} is installed. If not overridden at configure
time, it defaults to @samp{@var{prefix}/libexec}. These links assure
the @command{ppp} will invoke @command{nas.scm} when the user's session
starts and ends, thus giving it a possibility to send accounting
requests.
@item Configure file @file{raddb/client.conf}
@item Edit file @file{raddb/nas.rc}. The supplied @file{nas.rc} template
is tailored to work in most environments. The only variables you may
need to change are: @code{nas-log-facility}, specifying the syslog
facility to be used for logging and @code{pppd-args}, keeping the
arguments to be given to @command{ppp}. 
@item Configure your @file{/etc/inittab} and @command{getty}.

For example, if you use @command{mgetty}, then the @file{inittab}
entries for dial-up lines will look like:

@example
@group
d0:345:respawn:/sbin/mgetty ttyS0 vt100
d1:345:respawn:/sbin/mgetty ttyS1 vt100
...
@end group
@end example
@noindent

The mgetty's @file{login.config} will then contain the following line:

@example
*       -       -       /usr/local/libexec/nas.scm @
@end example

If you use @command{agetty}, then the @file{inittab} will contain
(with the long lines split for readability):

@example
@group
d0:345:respawn:/sbin/agetty -mt60 \
   -l /usr/local/libexec/nas.scm 38400,19200,9600 \
   ttyS0 vt100
d1:345:respawn:/sbin/agetty -mt60 \
   -l /usr/local/libexec/nas.scm 38400,19200,9600 \
   ttyS1 vt100
...
@end group
@end example
@noindent

@end enumerate

@comment *L2****************************************************************
@node pam_radius.so
@section pam_radius.so
@pindex pam_radius.so

@command{pam_radius.so} is a @acronym{PAM} module for radius
authentication. The module understands following command line options:

@table @option
@item audit
Enable audit information.
@item debug[=@var{level}]
Enable debugging information. The higher @var{level} is, the more
debugging info is output. When omitted, @var{level} defaults to
100. @emph{Please note}, that debugging levels equal to or greater than
10 compromise users' passwords, so use them sparingly.
@item use_authtok
Use authentication token passed from the previous module in stack.
@item confdir=@var{path}
Look for configuration files in @var{path}. Default is
@file{$sysconfdir/etc/raddb}.
@item service_type=@var{type}
Add @code{Service-Type=@var{type}} to the authentication request.
@var{type} must be a valid value, described in dictionary file.
@end table

@command{pam_radius.so} module logs its messages under @code{LOG_AUTH}
syslog facility.
